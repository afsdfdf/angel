# 天使加密奖励系统使用指南

## 概述

天使加密应用现已完全整合了真实的奖励机制和邀请链接系统，去除了所有演示数据。用户通过连接钱包即可登录，享受完整的奖励体验。

## 奖励机制

### 1. 新用户欢迎奖励
- **奖励金额**: 1000 ANGEL
- **获得条件**: 首次连接钱包注册
- **发放时机**: 用户创建成功后立即发放

### 2. 多级邀请奖励
- **一级邀请**: 500 ANGEL（直接邀请）
- **二级邀请**: 250 ANGEL（间接邀请）
- **三级邀请**: 100 ANGEL（三级邀请）

### 3. 奖励发放机制
- 所有奖励自动发放到用户的 `angel_balance` 字段
- 奖励记录保存在 `reward_records` 表中
- 支持奖励状态跟踪（pending/completed/failed）

## 邀请链接系统

### 1. 邀请链接格式
```
http://localhost:3000/invite/[邀请人钱包地址]
```

### 2. 邀请流程
1. 用户生成邀请链接
2. 分享给好友
3. 好友通过链接访问邀请页面
4. 好友连接钱包完成注册
5. 系统自动处理多级奖励

### 3. 邀请页面功能
- 显示邀请人信息
- 展示奖励机制说明
- 引导新用户连接钱包
- 自动处理推荐关系

## 数据库设置

### 1. 执行数据库脚本
```bash
# 在 Supabase 或 PostgreSQL 中执行
psql -d your_database -f database-setup.sql
```

### 2. 环境变量配置
```env
# Supabase 配置
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key

# 应用配置
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

### 3. 数据库表结构
- `users`: 用户信息表
- `invitations`: 邀请记录表
- `reward_records`: 奖励记录表
- `user_sessions`: 用户会话表

## 功能特性

### 1. 钱包连接即登录
- 连接钱包直接等于登录
- 老用户自动识别并登录
- 新用户引导完成注册

### 2. 邀请链接系统
- 使用钱包地址作为邀请标识符
- 邀请链接格式：`/invite/[钱包地址]`
- 推荐关系链追踪

### 3. 奖励统计
- 实时显示用户余额
- 累计收益统计
- 推荐人数统计

### 4. 邀请管理
- 生成邀请链接（基于钱包地址）
- 复制推荐码（仍用于奖励发放）
- 分享邀请链接（支持原生分享API）

## 使用说明

### 1. 普通用户
1. 访问应用首页
2. 点击"连接钱包"
3. 选择钱包并连接
4. 自动获得1000 ANGEL欢迎奖励

### 2. 被邀请用户
1. 点击邀请链接
2. 查看邀请信息和奖励说明
3. 连接钱包完成注册
4. 自动获得欢迎奖励
5. 邀请人获得相应奖励

### 3. 邀请他人
1. 连接钱包后查看个人信息
2. 点击分享按钮生成邀请链接
3. 分享给好友
4. 好友注册后自动获得奖励

## 开发模式

### 1. 模拟数据库
- 未配置Supabase时自动使用模拟数据库
- 数据保存在内存中，重启后清空
- 所有功能完全可用

### 2. 测试页面
- 访问 `/test-login` 进行系统测试
- 实时查看登录状态和数据库连接
- 测试钱包连接和用户创建

## 技术实现

### 1. 数据库函数
- `add_user_balance()`: 增加用户余额
- `process_referral_rewards()`: 处理多级奖励
- `increment_referral_count()`: 增加推荐数量

### 2. 前端组件
- `WalletConnect`: 钱包连接组件
- `InvitePage`: 邀请页面
- `PageHeader`: 页面头部（显示余额）

### 3. 服务层
- `DatabaseService`: 数据库操作服务
- `MockDatabaseService`: 模拟数据库服务
- `Web3Service`: 钱包连接服务

## 安全考虑

### 1. 数据验证
- 推荐码有效性验证
- 钱包地址格式验证
- 重复注册检查

### 2. 奖励防刷
- 每个钱包地址只能注册一次
- 推荐关系不可修改
- 奖励记录完整追踪

### 3. 会话管理
- 会话令牌自动过期
- 定期清理过期会话
- 安全的用户状态管理

## 故障排除

### 1. 钱包连接失败
- 检查是否安装MetaMask
- 确认网络连接
- 查看浏览器控制台错误

### 2. 数据库连接失败
- 检查环境变量配置
- 确认Supabase服务状态
- 查看服务器日志

### 3. 奖励未发放
- 检查数据库函数是否正确创建
- 确认用户创建流程
- 查看奖励记录表

## 更新日志

### v1.0.0
- ✅ 完整的奖励机制
- ✅ 邀请链接系统
- ✅ 去除所有演示数据
- ✅ 钱包连接即登录
- ✅ 多级奖励自动发放
- ✅ 模拟数据库支持
- ✅ 完整的数据库脚本

## 支持

如有问题或建议，请联系开发团队。 