# 钱包连接使用指南

## 新的连接流程

为了避免"pending request"错误，我们改进了钱包连接流程：

### 步骤1：连接钱包
1. 点击"连接钱包"按钮
2. 在MetaMask弹窗中点击"连接"
3. 等待钱包连接完成

### 步骤2：登录账户
1. 钱包连接成功后，会显示"登录账户"按钮
2. 点击"登录账户"按钮
3. 在MetaMask弹窗中签名消息
4. 等待登录完成

## 状态说明

### 🔗 未连接状态
- 显示"连接钱包"按钮
- 点击后连接MetaMask

### ✅ 钱包已连接，用户未登录
- 显示"登录账户"按钮
- 点击后进行签名和登录

### 👤 已连接且已登录
- 显示用户信息和下拉菜单
- 可以查看余额、邀请好友等

## 为什么这样设计？

### 问题原因
- MetaMask等钱包扩展程序对重复请求很敏感
- 自动登录可能导致多个签名请求同时发起
- 用户快速点击也会造成重复请求

### 解决方案
- 分离钱包连接和用户登录两个步骤
- 让用户主动控制登录时机
- 避免自动触发可能冲突的操作

## 故障排除

### 如果仍然遇到"pending request"错误：

1. **检查MetaMask**
   - 打开MetaMask扩展程序
   - 查看是否有待处理的请求
   - 完成或拒绝所有待处理请求

2. **刷新页面**
   - 按F5刷新页面
   - 重新开始连接流程

3. **重启MetaMask**
   - 关闭MetaMask扩展程序
   - 重新打开MetaMask
   - 重新尝试连接

4. **清除缓存**
   - 按Ctrl+Shift+R强制刷新
   - 或清除浏览器缓存

## 技术细节

### 防重复机制
- 组件级别的状态管理
- 钱包服务级别的请求控制
- 钱包地址级别的登录尝试跟踪

### 错误处理
- 识别特定的钱包错误类型
- 提供用户友好的错误消息
- 自动清理机制

## 用户体验改进

### 之前的问题
- 自动登录可能导致重复请求
- 用户无法控制登录时机
- 错误信息不够清晰

### 现在的改进
- 用户主动控制登录
- 清晰的状态指示
- 更好的错误处理
- 避免重复请求问题

## 未来计划

当钱包扩展程序的兼容性改善后，我们可能会：
- 重新启用自动登录功能
- 添加更多的连接选项
- 支持更多钱包类型 